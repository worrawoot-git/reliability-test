<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏à‡∏±‡∏¢ (IOC & Alpha)</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4f46e5; /* Indigo */
            --secondary: #4338ca;
            --bg: #f9fafb;
            --surface: #ffffff;
            --pass: #059669;
            --fail: #dc2626;
        }

        body {
            font-family: 'Sarabun', sans-serif;
            background-color: var(--bg);
            color: #1f2937;
            padding: 20px;
            margin: 0;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: var(--surface);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: var(--primary);
            margin-bottom: 25px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 2px solid #e5e7eb;
            margin-bottom: 20px;
        }

        .tab-btn {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 600;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.2s;
        }

        .tab-btn.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            background-color: #eef2ff;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.4s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Forms */
        .input-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }

        input[type="number"], textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 16px;
            box-sizing: border-box;
        }

        textarea {
            height: 200px;
            font-family: monospace;
            resize: vertical;
        }

        button.action-btn {
            width: 100%;
            padding: 12px;
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            margin-top: 10px;
        }

        button.action-btn:hover {
            background-color: var(--secondary);
        }

        /* Results */
        .result-card {
            margin-top: 20px;
            padding: 20px;
            background-color: #ecfdf5;
            border: 1px solid #10b981;
            border-radius: 8px;
            display: none;
        }

        .result-value {
            font-size: 36px;
            font-weight: bold;
            color: var(--pass);
            text-align: center;
            margin: 10px 0;
        }

        /* Table for IOC */
        .table-responsive {
            overflow-x: auto;
            margin-top: 15px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }

        th, td {
            border: 1px solid #e5e7eb;
            padding: 10px;
            text-align: center;
        }

        th {
            background-color: #f3f4f6;
            color: #374151;
        }

        select {
            padding: 5px;
            border-radius: 4px;
            border: 1px solid #d1d5db;
            width: 100%;
        }

        .status-pass { color: var(--pass); font-weight: bold; }
        .status-fail { color: var(--fail); font-weight: bold; }
        
        .note {
            font-size: 0.9em;
            color: #6b7280;
            margin-top: 5px;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>üìä ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ß‡∏¥‡∏à‡∏±‡∏¢</h1>

    <div class="tabs">
        <button class="tab-btn active" onclick="openTab('ioc')">1. ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á‡∏ï‡∏£‡∏á (IOC)</button>
        <button class="tab-btn" onclick="openTab('alpha')">2. ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏±‡πà‡∏ô (Alpha)</button>
    </div>

    <div id="ioc" class="tab-content active">
        <h3>‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏î‡∏±‡∏ä‡∏ô‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á (IOC)</h3>
        <p class="note">‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏•‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</p>
        
        <div style="display: flex; gap: 15px;">
            <div style="flex: 1;">
                <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</label>
                <input type="number" id="ioc_items" value="5" min="1">
            </div>
            <div style="flex: 1;">
                <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç</label>
                <input type="number" id="ioc_experts" value="3" min="1">
            </div>
        </div>
        
        <button class="action-btn" onclick="createIOCTable()" style="background-color: #4b5563; margin-bottom: 20px;">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á</button>

        <div id="ioc_wrapper" style="display:none;">
            <div class="table-responsive">
                <table id="ioc_table">
                    <thead></thead>
                    <tbody></tbody>
                </table>
            </div>
            
            <button class="action-btn" onclick="calculateIOC()">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå IOC</button>
            
            <div id="ioc_result" class="result-card">
                <h4 style="margin-top:0;">‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</h4>
                <div id="ioc_details"></div>
            </div>
        </div>
    </div>

    <div id="alpha" class="tab-content">
        <h3>‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Cronbach's Alpha Coefficient</h3>
        <p class="note">
            ‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ: Copy ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏¥‡∏ö‡∏à‡∏≤‡∏Å Excel (‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç) ‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏≥‡∏°‡∏≤‡∏ß‡∏≤‡∏á‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á<br>
            * ‡πÅ‡∏ñ‡∏ß‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô = ‡∏ú‡∏π‡πâ‡∏ï‡∏≠‡∏ö‡πÅ‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏° (Respondents)<br>
            * ‡πÅ‡∏ñ‡∏ß‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á = ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° (Items)
        </p>
        
        <div class="input-group">
            <textarea id="alpha_data" placeholder="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:
5	4	5	4
4	3	4	4
5	5	4	5
..."></textarea>
        </div>

        <button class="action-btn" onclick="calculateAlpha()">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤ Alpha</button>

        <div id="alpha_result" class="result-card">
            <div style="text-align: center;">‡∏Ñ‡πà‡∏≤‡∏™‡∏±‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏≠‡∏•‡∏ü‡∏≤ (Œ±-coefficient)</div>
            <div class="result-value" id="alpha_value">0.000</div>
            <div id="alpha_interpretation" style="text-align: center; font-weight: bold;"></div>
            <p class="note" style="text-align: center;">(‡∏à‡∏≤‡∏Å‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á <span id="n_respondents">0</span> ‡∏Ñ‡∏ô, ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô <span id="n_items">0</span> ‡∏Ç‡πâ‡∏≠)</p>
        </div>
    </div>

</div>

<script>
    // --- Tab Switching ---
    function openTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tabName).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    // --- IOC Logic ---
    function createIOCTable() {
        const items = parseInt(document.getElementById('ioc_items').value);
        const experts = parseInt(document.getElementById('ioc_experts').value);
        
        if(!items || !experts) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡∏∞‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç");

        const table = document.getElementById('ioc_table');
        let headerHTML = '<tr><th style="width:50px">‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà</th>';
        
        for(let i=1; i<=experts; i++) {
            headerHTML += `<th>‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà ${i}</th>`;
        }
        headerHTML += '<th style="width:100px">‡∏Ñ‡πà‡∏≤ IOC</th><th style="width:100px">‡πÅ‡∏õ‡∏•‡∏ú‡∏•</th></tr>';
        table.querySelector('thead').innerHTML = headerHTML;

        let bodyHTML = '';
        for(let i=1; i<=items; i++) {
            bodyHTML += `<tr><td>${i}</td>`;
            for(let j=1; j<=experts; j++) {
                bodyHTML += `
                <td>
                    <select class="ioc-input" data-row="${i}">
                        <option value="1">+1 (‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á)</option>
                        <option value="0">0 (‡πÑ‡∏°‡πà‡πÅ‡∏ô‡πà‡πÉ‡∏à)</option>
                        <option value="-1">-1 (‡πÑ‡∏°‡πà‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á)</option>
                    </select>
                </td>`;
            }
            bodyHTML += `<td id="ioc-val-${i}">-</td><td id="ioc-res-${i}">-</td></tr>`;
        }
        table.querySelector('tbody').innerHTML = bodyHTML;
        document.getElementById('ioc_wrapper').style.display = 'block';
        document.getElementById('ioc_result').style.display = 'none';
    }

    function calculateIOC() {
        const items = parseInt(document.getElementById('ioc_items').value);
        const experts = parseInt(document.getElementById('ioc_experts').value);
        const inputs = document.querySelectorAll('.ioc-input');
        
        let scores = {};
        inputs.forEach(inp => {
            const row = inp.getAttribute('data-row');
            const val = parseInt(inp.value);
            scores[row] = (scores[row] || 0) + val;
        });

        let passCount = 0;
        let detailsHTML = "<ul style='text-align:left;'>";

        for(let i=1; i<=items; i++) {
            let sum = scores[i] || 0;
            let ioc = sum / experts;
            let passed = ioc >= 0.5;
            
            // Update Table
            document.getElementById(`ioc-val-${i}`).innerText = ioc.toFixed(2);
            document.getElementById(`ioc-res-${i}`).innerHTML = passed 
                ? '<span class="status-pass">‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ</span>' 
                : '<span class="status-fail">‡∏ï‡∏±‡∏î‡∏≠‡∏≠‡∏Å</span>';

            if(passed) passCount++;
            else detailsHTML += `<li>‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà ${i}: IOC = ${ioc.toFixed(2)} <span class="status-fail">(‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á)</span></li>`;
        }
        detailsHTML += "</ul>";

        const resultDiv = document.getElementById('ioc_result');
        const detailDiv = document.getElementById('ioc_details');
        
        resultDiv.style.display = 'block';
        if(passCount === items) {
            detailDiv.innerHTML = `<p class="status-pass" style="font-size:18px">‚úÖ ‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠ (IOC ‚â• 0.5)</p>`;
        } else {
            detailDiv.innerHTML = `<p>‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå ${passCount} ‡∏Ç‡πâ‡∏≠, <span class="status-fail">‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô ${items - passCount} ‡∏Ç‡πâ‡∏≠</span> ‡∏î‡∏±‡∏á‡∏ô‡∏µ‡πâ:</p>` + detailsHTML;
        }
    }

    // --- Alpha Logic ---
    function calculateAlpha() {
        const rawText = document.getElementById('alpha_data').value.trim();
        if(!rawText) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏•‡∏á‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á");

        // Parse Data
        const rows = rawText.split('\n').filter(r => r.trim() !== '');
        const data = rows.map(r => r.trim().split(/[\t, ]+/).map(Number));

        const n = data.length; // Respondents
        const k = data[0].length; // Items (Questions)

        if(n < 2) return alert("‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏ï‡∏≠‡∏ö‡πÅ‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 2 ‡∏Ñ‡∏ô");
        
        // 1. Calculate Variance for each item (column)
        let sumItemVariance = 0;
        for(let col=0; col<k; col++) {
            let colData = data.map(row => row[col]);
            sumItemVariance += getVariance(colData);
        }

        // 2. Calculate Variance of total scores (row sums)
        let totalScores = data.map(row => row.reduce((a, b) => a + b, 0));
        let totalVariance = getVariance(totalScores);

        // 3. Formula: (k / k-1) * (1 - (sumItemVar / totalVar))
        let alpha = (k / (k - 1)) * (1 - (sumItemVariance / totalVariance));

        // Display
        document.getElementById('alpha_result').style.display = 'block';
        document.getElementById('alpha_value').innerText = alpha.toFixed(4);
        document.getElementById('n_respondents').innerText = n;
        document.getElementById('n_items').innerText = k;

        // Interpret
        let text = "";
        let color = "";
        if(alpha >= 0.9) { text = "‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏î‡∏µ‡∏°‡∏≤‡∏Å (Excellent)"; color = "#047857"; }
        else if(alpha >= 0.8) { text = "‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏î‡∏µ (Good)"; color = "#059669"; }
        else if(alpha >= 0.7) { text = "‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ (Acceptable)"; color = "#d97706"; }
        else if(alpha >= 0.6) { text = "‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πà‡∏≤‡∏™‡∏á‡∏™‡∏±‡∏¢ (Questionable)"; color = "#ca8a04"; }
        else { text = "‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÑ‡∏°‡πà‡∏î‡∏µ/‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á (Poor)"; color = "#dc2626"; }
        
        const interpDiv = document.getElementById('alpha_interpretation');
        interpDiv.innerText = text;
        interpDiv.style.color = color;
    }

    function getVariance(arr) {
        const n = arr.length;
        if (n <= 1) return 0;
        const mean = arr.reduce((a, b) => a + b) / n;
        const sumSqDiff = arr.map(x => Math.pow(x - mean, 2)).reduce((a, b) => a + b);
        return sumSqDiff / (n - 1); // Sample Variance
    }
</script>

</body>
</html>
