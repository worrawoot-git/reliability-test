<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏á‡∏≤‡∏ô‡∏ß‡∏¥‡∏à‡∏±‡∏¢ (Fixed PDF)</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #4f46e5;
            --secondary: #4338ca;
            --bg: #f9fafb;
            --surface: #ffffff;
            --pass: #059669;
            --fail: #dc2626;
        }

        body {
            font-family: 'Sarabun', sans-serif;
            background-color: var(--bg);
            color: #1f2937;
            padding: 20px;
            margin: 0;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: var(--surface);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            color: var(--primary);
            margin-bottom: 25px;
        }

        /* Tabs */
        .tabs { display: flex; border-bottom: 2px solid #e5e7eb; margin-bottom: 20px; }
        .tab-btn { flex: 1; padding: 15px; background: none; border: none; font-size: 16px; font-weight: 600; color: #6b7280; cursor: pointer; }
        .tab-btn.active { color: var(--primary); border-bottom: 3px solid var(--primary); background-color: #eef2ff; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* Forms */
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: 600; }
        input[type="number"], textarea { width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 6px; box-sizing: border-box; font-size: 16px; }
        textarea { height: 200px; font-family: monospace; }

        /* Buttons */
        .btn-group { display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap; }
        button { padding: 12px; border: none; border-radius: 6px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.2s; }
        
        .btn-main { flex: 2; background-color: var(--primary); color: white; }
        .btn-main:hover { background-color: var(--secondary); }
        
        .btn-reset { flex: 1; background-color: #e5e7eb; color: #374151; }
        .btn-reset:hover { background-color: #d1d5db; }

        /* Export Section */
        .export-section {
            display: none; 
            gap: 10px; margin-top: 15px; padding-top: 15px; border-top: 1px dashed #d1d5db;
        }
        .btn-excel { flex: 1; background-color: #107c41; color: white; }
        .btn-pdf { flex: 1; background-color: #b30b00; color: white; }
        .btn-print { flex: 1; background-color: #374151; color: white; }

        /* Results */
        .result-card { margin-top: 20px; padding: 20px; background-color: #ecfdf5; border: 1px solid #10b981; border-radius: 8px; display: none; }
        .result-value { font-size: 36px; font-weight: bold; color: var(--pass); text-align: center; margin: 10px 0; }

        /* Table */
        .table-responsive { overflow-x: auto; margin-top: 15px; }
        table { width: 100%; border-collapse: collapse; min-width: 600px; }
        th, td { border: 1px solid #e5e7eb; padding: 10px; text-align: center; }
        th { background-color: #f3f4f6; color: #374151; }
        select { padding: 5px; width: 100%; }
        
        .status-pass { color: var(--pass); font-weight: bold; }
        .status-fail { color: var(--fail); font-weight: bold; }
        .error-msg { color: #dc2626; font-weight: bold; margin-top: 10px; display: none; padding: 10px; background-color: #fee2e2; border-radius: 6px; }

        /* @MEDIA PRINT: ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏° "‡∏û‡∏¥‡∏°‡∏û‡πå (‡∏ä‡∏±‡∏ß‡∏£‡πå‡∏™‡∏∏‡∏î)" */
        @media print {
            body * { visibility: hidden; }
            .print-area, .print-area * { visibility: visible; }
            .print-area { position: absolute; left: 0; top: 0; width: 100%; }
            /* ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏¥‡∏°‡∏û‡πå */
            button, .input-group, .tabs, h1 { display: none !important; }
            .result-card { border: 1px solid #000; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>üìä ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ß‡∏¥‡∏à‡∏±‡∏¢</h1>

    <div class="tabs">
        <button class="tab-btn active" onclick="openTab('ioc')">1. ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á‡∏ï‡∏£‡∏á (IOC)</button>
        <button class="tab-btn" onclick="openTab('alpha')">2. ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏±‡πà‡∏ô (Alpha)</button>
    </div>

    <div id="ioc" class="tab-content active">
        <h3>‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏î‡∏±‡∏ä‡∏ô‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á (IOC)</h3>
        
        <div style="display: flex; gap: 15px;">
            <div style="flex: 1;">
                <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</label>
                <input type="number" id="ioc_items" value="5" min="1">
            </div>
            <div style="flex: 1;">
                <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç</label>
                <input type="number" id="ioc_experts" value="3" min="1">
            </div>
        </div>
        
        <div class="btn-group">
            <button class="btn-main" onclick="createIOCTable()" style="background-color: #4b5563;">‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á</button>
            <button class="btn-reset" onclick="resetIOC()">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
        </div>

        <div id="ioc_wrapper" style="display:none;">
            <div id="ioc_print_area" class="print-area">
                <div class="table-responsive">
                    <table id="ioc_table"><thead></thead><tbody></tbody></table>
                </div>
                <div id="ioc_result" class="result-card">
                    <h4 style="margin-top:0;">‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</h4>
                    <div id="ioc_details"></div>
                </div>
            </div>

            <button class="btn-main" style="width:100%; margin-top:15px;" onclick="calculateIOC()">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå IOC</button>

            <div id="ioc_export_btns" class="export-section">
                <button class="btn-excel" onclick="exportIOCExcel()">üì• Excel</button>
                <button class="btn-pdf" onclick="exportIOCPDF()">üìÑ PDF (‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå)</button>
                <button class="btn-print" onclick="window.print()">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå (‡∏ä‡∏±‡∏ß‡∏£‡πå‡∏™‡∏∏‡∏î)</button>
            </div>
        </div>
    </div>

    <div id="alpha" class="tab-content">
        <h3>‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Cronbach's Alpha</h3>
        <p style="font-size:0.9em; color:#666;">Copy ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏à‡∏≤‡∏Å Excel ‡∏°‡∏≤‡∏ß‡∏≤‡∏á</p>
        
        <div class="input-group">
            <textarea id="alpha_data" placeholder="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á:
5	4	5
4	3	4
..."></textarea>
            <div id="alpha_error" class="error-msg"></div>
        </div>

        <div class="btn-group">
            <button class="btn-main" onclick="calculateAlpha()">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤ Alpha</button>
            <button class="btn-reset" onclick="resetAlpha()">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</button>
        </div>

        <div id="alpha_wrapper" style="display:none;">
            <div id="alpha_print_area" class="print-area">
                <div class="result-card" style="display:block;">
                    <div style="text-align: center;">‡∏Ñ‡πà‡∏≤‡∏™‡∏±‡∏°‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÅ‡∏≠‡∏•‡∏ü‡∏≤ (Œ±-coefficient)</div>
                    <div class="result-value" id="alpha_value">0.000</div>
                    <div id="alpha_interpretation" style="text-align: center; font-weight: bold;"></div>
                    <p style="text-align: center; font-size:0.9em;">(N = <span id="n_respondents">0</span>, ‡∏Ç‡πâ‡∏≠ = <span id="n_items">0</span>)</p>
                </div>
            </div>

            <div id="alpha_export_btns" class="export-section">
                <button class="btn-excel" onclick="exportAlphaExcel()">üì• Excel</button>
                <button class="btn-pdf" onclick="exportAlphaPDF()">üìÑ PDF (‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå)</button>
                <button class="btn-print" onclick="window.print()">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå (‡∏ä‡∏±‡∏ß‡∏£‡πå‡∏™‡∏∏‡∏î)</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<script>
    // --- Tab Switching ---
    function openTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tabName).classList.add('active');
        event.currentTarget.classList.add('active');
        // Reset classes for printing
        document.querySelectorAll('.print-area').forEach(el => el.classList.remove('print-area'));
        if(tabName === 'ioc') document.getElementById('ioc_print_area').classList.add('print-area');
        if(tabName === 'alpha') document.getElementById('alpha_print_area').classList.add('print-area');
    }

    // ================= IOC LOGIC =================
    function createIOCTable() {
        const items = parseInt(document.getElementById('ioc_items').value);
        const experts = parseInt(document.getElementById('ioc_experts').value);
        if(!items || !experts) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô");

        const table = document.getElementById('ioc_table');
        let headerHTML = '<tr><th style="width:50px">‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà</th>';
        for(let i=1; i<=experts; i++) headerHTML += `<th>‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç ${i}</th>`;
        headerHTML += '<th style="width:100px">IOC</th><th style="width:100px">‡∏ú‡∏•</th></tr>';
        table.querySelector('thead').innerHTML = headerHTML;

        let bodyHTML = '';
        for(let i=1; i<=items; i++) {
            bodyHTML += `<tr><td>${i}</td>`;
            for(let j=1; j<=experts; j++) bodyHTML += `<td><select class="ioc-input" data-row="${i}"><option value="1">+1</option><option value="0">0</option><option value="-1">-1</option></select></td>`;
            bodyHTML += `<td id="ioc-val-${i}">-</td><td id="ioc-res-${i}">-</td></tr>`;
        }
        table.querySelector('tbody').innerHTML = bodyHTML;
        document.getElementById('ioc_wrapper').style.display = 'block';
        document.getElementById('ioc_result').style.display = 'none';
        document.getElementById('ioc_export_btns').style.display = 'none';
        
        // Setup print area
        document.querySelectorAll('.print-area').forEach(el => el.classList.remove('print-area'));
        document.getElementById('ioc_print_area').classList.add('print-area');
    }

    function calculateIOC() {
        const items = parseInt(document.getElementById('ioc_items').value);
        const experts = parseInt(document.getElementById('ioc_experts').value);
        const inputs = document.querySelectorAll('.ioc-input');
        let scores = {};
        
        inputs.forEach(inp => {
            const row = inp.getAttribute('data-row');
            scores[row] = (scores[row] || 0) + parseInt(inp.value);
        });

        let passCount = 0;
        let detailsHTML = "<ul style='text-align:left; padding-left:20px;'>";

        for(let i=1; i<=items; i++) {
            let ioc = (scores[i] || 0) / experts;
            let passed = ioc >= 0.5;
            document.getElementById(`ioc-val-${i}`).innerText = ioc.toFixed(2);
            document.getElementById(`ioc-res-${i}`).innerHTML = passed ? '<span class="status-pass">‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ</span>' : '<span class="status-fail">‡∏ï‡∏±‡∏î‡∏≠‡∏≠‡∏Å</span>';
            if(passed) passCount++;
            else detailsHTML += `<li>‡∏Ç‡πâ‡∏≠‡∏ó‡∏µ‡πà ${i}: IOC = ${ioc.toFixed(2)} <span class="status-fail">(‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á)</span></li>`;
        }
        detailsHTML += "</ul>";

        document.getElementById('ioc_result').style.display = 'block';
        const detailDiv = document.getElementById('ioc_details');
        if(passCount === items) detailDiv.innerHTML = `<p class="status-pass">‚úÖ ‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠ (IOC ‚â• 0.5)</p>`;
        else detailDiv.innerHTML = `<p>‡∏ú‡πà‡∏≤‡∏ô ${passCount} ‡∏Ç‡πâ‡∏≠, <span class="status-fail">‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô ${items - passCount} ‡∏Ç‡πâ‡∏≠</span>:</p>` + detailsHTML;
        
        document.getElementById('ioc_export_btns').style.display = 'flex';
    }

    // ================= ALPHA LOGIC =================
    function calculateAlpha() {
        const rawText = document.getElementById('alpha_data').value.trim();
        const errorBox = document.getElementById('alpha_error');
        errorBox.style.display = 'none';
        if(!rawText) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");

        let validData = [];
        const lines = rawText.split('\n');
        for(let line of lines) {
            line = line.trim();
            if(line === '') continue;
            const parts = line.split(/[\t, ]+/).map(p => parseFloat(p));
            if(!parts.some(isNaN) && parts.length > 1) validData.push(parts);
        }

        if(validData.length < 2) {
            errorBox.innerText = "‚ùå ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 2 ‡πÅ‡∏ñ‡∏ß)";
            errorBox.style.display = 'block'; return;
        }

        const n = validData.length;
        const k = validData[0].length;
        let sumItemVar = 0;
        for(let c=0; c<k; c++) sumItemVar += getVariance(validData.map(r => r[c]));
        
        let totalScores = validData.map(r => r.reduce((a,b)=>a+b,0));
        let totalVar = getVariance(totalScores);

        if(totalVar === 0) {
            errorBox.innerText = "‚ùå ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏õ‡∏£‡∏õ‡∏£‡∏ß‡∏ô‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô 0 (‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)";
            errorBox.style.display = 'block'; return;
        }

        let alpha = (k/(k-1)) * (1 - (sumItemVar/totalVar));
        
        document.getElementById('alpha_wrapper').style.display = 'block';
        document.getElementById('alpha_value').innerText = alpha.toFixed(4);
        document.getElementById('n_respondents').innerText = n;
        document.getElementById('n_items').innerText = k;
        
        let text = "", color = "";
        if(alpha >= 0.9) { text = "‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏î‡∏µ‡∏°‡∏≤‡∏Å (Excellent)"; color = "#047857"; }
        else if(alpha >= 0.8) { text = "‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏î‡∏µ (Good)"; color = "#059669"; }
        else if(alpha >= 0.7) { text = "‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏¢‡∏≠‡∏°‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ (Acceptable)"; color = "#d97706"; }
        else if(alpha >= 0.6) { text = "‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πà‡∏≤‡∏™‡∏á‡∏™‡∏±‡∏¢ (Questionable)"; color = "#ca8a04"; }
        else { text = "‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÑ‡∏°‡πà‡∏î‡∏µ/‡∏Ñ‡∏ß‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á (Poor)"; color = "#dc2626"; }
        
        const interpDiv = document.getElementById('alpha_interpretation');
        interpDiv.innerText = text;
        interpDiv.style.color = color;
        
        document.getElementById('alpha_export_btns').style.display = 'flex';
        
        // Setup print area
        document.querySelectorAll('.print-area').forEach(el => el.classList.remove('print-area'));
        document.getElementById('alpha_print_area').classList.add('print-area');
    }

    function getVariance(arr) {
        const n = arr.length;
        if(n <= 1) return 0;
        const mean = arr.reduce((a,b)=>a+b)/n;
        return arr.reduce((a,b)=>a+Math.pow(b-mean,2),0)/(n-1);
    }

    function resetIOC() {
        document.getElementById('ioc_wrapper').style.display = 'none';
        document.getElementById('ioc_items').value = 5;
    }
    function resetAlpha() {
        document.getElementById('alpha_data').value = "";
        document.getElementById('alpha_wrapper').style.display = 'none';
    }

    // ================= EXPORT FUNCTIONS =================
    
    // 1. PDF Export (html2pdf)
    function exportIOCPDF() {
        if(typeof html2pdf === 'undefined') return alert("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° PDF... ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏õ‡∏∏‡πà‡∏° '‡∏û‡∏¥‡∏°‡∏û‡πå'");
        const element = document.getElementById('ioc_print_area');
        const opt = { margin: 0.5, filename: 'IOC_Report.pdf', image: { type: 'jpeg', quality: 0.98 }, html2canvas: { scale: 2 }, jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' } };
        html2pdf().set(opt).from(element).save().catch(err => alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err + "\n\n‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡∏∏‡πà‡∏° '‡∏û‡∏¥‡∏°‡∏û‡πå (‡∏ä‡∏±‡∏ß‡∏£‡πå‡∏™‡∏∏‡∏î)' ‡πÅ‡∏ó‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö"));
    }

    function exportAlphaPDF() {
        if(typeof html2pdf === 'undefined') return alert("‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏° PDF... ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏õ‡∏∏‡πà‡∏° '‡∏û‡∏¥‡∏°‡∏û‡πå'");
        const element = document.getElementById('alpha_print_area');
        const opt = { margin: 1, filename: 'Alpha_Report.pdf', image: { type: 'jpeg', quality: 0.98 }, html2canvas: { scale: 2 }, jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' } };
        html2pdf().set(opt).from(element).save().catch(err => alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + err + "\n\n‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡∏õ‡∏∏‡πà‡∏° '‡∏û‡∏¥‡∏°‡∏û‡πå (‡∏ä‡∏±‡∏ß‡∏£‡πå‡∏™‡∏∏‡∏î)' ‡πÅ‡∏ó‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö"));
    }

    // 2. Excel Export
    function exportIOCExcel() {
        let originalTable = document.getElementById('ioc_table');
        let tableClone = originalTable.cloneNode(true);
        let inputs = originalTable.querySelectorAll('.ioc-input');
        let cloneInputs = tableClone.querySelectorAll('.ioc-input');
        
        inputs.forEach((inp, i) => {
            cloneInputs[i].parentElement.innerHTML = inp.options[inp.selectedIndex].text;
        });
        
        var wb = XLSX.utils.table_to_book(tableClone, {sheet: "IOC Results"});
        XLSX.writeFile(wb, 'IOC_Analysis.xlsx');
    }

    function exportAlphaExcel() {
        const val = document.getElementById('alpha_value').innerText;
        const interp = document.getElementById('alpha_interpretation').innerText;
        const n = document.getElementById('n_respondents').innerText;
        const k = document.getElementById('n_items').innerText;

        const data = [
            ["Cronbach's Alpha Report"],
            ["Date", new Date().toLocaleString()],
            [],
            ["Alpha Coefficient", parseFloat(val)],
            ["Interpretation", interp],
            ["Respondents (N)", parseInt(n)],
            ["Items", parseInt(k)]
        ];

        const wb = XLSX.utils.book_new();
        const ws = XLSX.utils.aoa_to_sheet(data);
        XLSX.utils.book_append_sheet(wb, ws, "Alpha Result");
        XLSX.writeFile(wb, 'Alpha_Analysis.xlsx');
    }

</script>

</body>
</html>
